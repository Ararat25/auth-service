# auth-service

Сервис аутентификации на Go.  
Реализует работу с JWT access-токенами и refresh-токенами.

---

## Оглавление

- [Описание](#описание)
- [Требования](#требования)
- [Запуск](#запуск)
- [API](#api)
- [Документация](#документация)
- [Стек технологий](#стек-технологий)

---

## Описание

Сервис предоставляет 4 основные конечные точки API:

- Получение пары токенов (access и refresh) по GUID пользователя
- Обновление пары токенов (refresh)
- Получение GUID текущего пользователя (защищённый маршрут)
- Деавторизация пользователя (аннулирование сессии)

---

## Требования

### Access токен

- JWT формат
- Алгоритм подписи: SHA512
- НЕ хранится в базе

### Refresh токен

- Произвольный формат, передаётся в base64
- Хранится в базе только bcrypt-хеш
- Защищён от повторного использования
- Защищён от изменений на клиенте

### Операция refresh

- Может быть выполнена только парой токенов, выданной вместе
- Запрещено обновление при изменении User-Agent; в случае нарушения — деавторизация пользователя
- При смене IP отправляется POST-запрос на webhook с информацией о попытке входа с другого IP (операция не запрещается)

---

## Запуск

Для запуска проекта необходимо выполнить:

```bash
docker-compose -f docker-compose.yml up -d
```
Всё запускается с дефолтными настройками из конфигурационных файлов и .env.

---

## API
- `GET /api/tokens?userId={GUID}` — получить пару токенов для пользователя
- `GET /api/refresh` — обновить пару токенов (access в JSON, refresh в cookie)
- `GET /api/me` — получить GUID текущего пользователя (требует access token)
- `GET /api/logout` — деавторизация пользователя (требует access token)

---

## Документация
Swagger UI доступен по адресу:  
[http://localhost:8080/api/docs/index.html](http://localhost:8080/api/docs/index.html)  
В документации описаны все эндпоинты, возможные ошибки и примеры запросов.

---

## Стек технологий
- Go (chi и net/http)
- PostgreSQL (в Docker контейнере)
- Docker + Docker Compose
- JWT с SHA512
- bcrypt для хеширования refresh токенов
- Swagger для документации API

---

## Особенности реализации
- Проверка User-Agent и IP при обновлении токенов
- Отправка уведомления на webhook при смене IP
- Защита от повторного использования refresh токена
- Безопасное хранение refresh токенов через bcrypt-хеш
- JWT access токен не хранится в БД
